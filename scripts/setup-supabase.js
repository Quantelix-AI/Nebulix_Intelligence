#!/usr/bin/env node

/**
 * Supabase å¿«é€Ÿè®¾ç½®è„šæœ¬
 * å¸®åŠ©æ–°ç”¨æˆ·å¿«é€Ÿé…ç½®Supabaseé¡¹ç›®
 */

const fs = require('fs');
const path = require('path');
const readline = require('readline');

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

function question(prompt) {
  return new Promise((resolve) => {
    rl.question(prompt, resolve);
  });
}

async function main() {
  console.log('ğŸš€ Nebulix Intelligence - Supabaseå¿«é€Ÿè®¾ç½®');
  console.log('=====================================\n');

  console.log('è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤é…ç½®æ‚¨çš„Supabaseé¡¹ç›®ï¼š\n');

  // è·å–ç”¨æˆ·è¾“å…¥
  const projectId = await question('1. è¯·è¾“å…¥æ‚¨çš„Supabaseé¡¹ç›®ID: ');
  const anonKey = await question('2. è¯·è¾“å…¥æ‚¨çš„Supabase Anon Key: ');
  const serviceKey = await question('3. è¯·è¾“å…¥æ‚¨çš„Supabase Service Role Key (å¯é€‰ï¼Œç”¨äºç®¡ç†åŠŸèƒ½): ');

  if (!projectId || !anonKey) {
    console.error('âŒ é¡¹ç›®IDå’ŒAnon Keyæ˜¯å¿…éœ€çš„ï¼');
    process.exit(1);
  }

  const supabaseUrl = `https://${projectId}.supabase.co`;

  console.log('\nğŸ“ æ­£åœ¨ç”Ÿæˆé…ç½®æ–‡ä»¶...\n');

  // æ›´æ–° utils/supabase/info.tsx
  const infoContent = `/* AUTOGENERATED FILE - DO NOT EDIT CONTENTS */

export const projectId = "${projectId}"
export const publicAnonKey = "${anonKey}"
`;

  const infoPath = path.join(__dirname, '..', 'utils', 'supabase', 'info.tsx');
  fs.writeFileSync(infoPath, infoContent);
  console.log('âœ… å·²æ›´æ–° utils/supabase/info.tsx');

  // åˆ›å»º .env.local æ–‡ä»¶
  const envContent = `# Supabaseé…ç½®
VITE_SUPABASE_URL=${supabaseUrl}
VITE_SUPABASE_ANON_KEY=${anonKey}
${serviceKey ? `VITE_SUPABASE_SERVICE_ROLE_KEY=${serviceKey}` : ''}

# APIé…ç½®
VITE_API_BASE_URL=${supabaseUrl}/functions/v1/make-server-43636d2b

# åº”ç”¨é…ç½®
VITE_APP_NAME=Nebulix Intelligence
VITE_APP_VERSION=0.1.0
VITE_DEVELOPMENT_MODE=false

# æ–‡ä»¶ä¸Šä¼ é…ç½®
VITE_MAX_FILE_SIZE=10485760
VITE_ALLOWED_FILE_TYPES=image/*,text/*,application/pdf

# AIæ¨¡å‹é…ç½®
VITE_DEFAULT_AI_MODEL=deepseek-chat
VITE_MAX_TOKENS=4000

# ç½‘ç»œè¯Šæ–­
VITE_ENABLE_NETWORK_DIAGNOSTICS=true
`;

  const envPath = path.join(__dirname, '..', '.env.local');
  fs.writeFileSync(envPath, envContent);
  console.log('âœ… å·²åˆ›å»º .env.local æ–‡ä»¶');

  console.log('\nğŸ‰ é…ç½®å®Œæˆï¼\n');

  console.log('ğŸ“‹ æ¥ä¸‹æ¥çš„æ­¥éª¤ï¼š');
  console.log('1. åœ¨Supabaseä¸­è¿è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬ (supabase/migrations/001_initial_schema.sql)');
  console.log('2. éƒ¨ç½²Edge Functions: supabase functions deploy');
  console.log('3. é…ç½®è®¤è¯æä¾›å•† (Google, GitHubç­‰)');
  console.log('4. è®¾ç½®Edge Functionsç¯å¢ƒå˜é‡');
  console.log('5. è¿è¡Œåº”ç”¨: npm run dev\n');

  console.log('ğŸ“š è¯¦ç»†é…ç½®æŒ‡å—è¯·æŸ¥çœ‹: docs/SUPABASE_SETUP.md\n');